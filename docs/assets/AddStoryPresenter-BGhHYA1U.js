class a{constructor(t,e){this.view=t,this.model=e,this.photoFile=null,this.selectedLocation=null}render(){return this.view.render()}async init(){try{await this.view.init(),this.view.setupEventListeners(this.handleSubmit.bind(this),this.handlePhotoUpload.bind(this),this.handleCamera.bind(this),this.handleMapClick.bind(this)),this.view.setupNavigationListener(this.cleanup.bind(this))}catch{this.view.showError("Failed to initialize. Please try again.")}}async handleMapClick(t){try{const{lng:e,lat:i}=t.lngLat;this.selectedLocation={lat:i,lng:e};const s=await this.view.getAddress(i,e);this.view.updateLocation(i,e,s)}catch{this.view.showError("Failed to set location. Please try again.")}}handlePhotoUpload(t){if(!t){this.view.showError("No file selected.");return}if(!["image/jpeg","image/png"].includes(t.type)){this.view.showError("Only JPEG or PNG files are allowed.");return}if(t.size>1*1024*1024){this.view.showError("Photo must be less than 1MB.");return}this.photoFile=t,this.view.showPhotoPreview(URL.createObjectURL(t))}async handleCamera(){try{await this.view.startCamera(this.handleCapture.bind(this))}catch(t){this.view.showError(t.message)}}handleCapture(t){try{if(!t)throw new Error("Tidak ada foto yang diambil");this.photoFile=new File([t],"photo.jpg",{type:"image/jpeg",lastModified:Date.now()});const e=URL.createObjectURL(t);this.view.showPhotoPreview(e),this.view.updatePhotoInput(this.photoFile)}catch{this.view.showError("Gagal memproses foto. Silakan coba lagi.")}}async handleSubmit(t){try{if(!this.photoFile&&!t.get("photo")){this.view.showError("Mohon unggah atau ambil foto.");return}if(!this.selectedLocation){this.view.showError("Mohon pilih lokasi pada peta.");return}const e=t.get("description");if(!e||e.length<10){this.view.showError("Deskripsi harus minimal 10 karakter.");return}!t.get("photo")&&this.photoFile&&t.set("photo",this.photoFile),t.set("lat",this.selectedLocation.lat.toString()),t.set("lon",this.selectedLocation.lng.toString()),await this.view.stopCamera(),await this.model.addStory(t),await this.cleanup(),this.view.goToHomePage()}catch(e){this.view.showError(e.message||"Gagal menambahkan story. Silakan coba lagi.")}}async cleanup(){try{await this.view.cleanup(),this.photoFile=null,this.selectedLocation=null}catch{this.view.showError("Cleanup failed.")}}}export{a as AddStoryPresenter};
